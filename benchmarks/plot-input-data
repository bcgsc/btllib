#!/usr/bin/env Rscript

library(ggplot2)
library(dplyr)
library(lubridate)

timing <- read.csv("input_data.csv", stringsAsFactors = FALSE)

# Rename code column to Code
timing$Code <- timing$code

timing <- timing %>%
  group_by(threads, code) %>%
  mutate(tm = mean(period_to_seconds(ms(time))))

timing <- timing %>%
  group_by(threads, code) %>%
  mutate(tm_points = period_to_seconds(ms(time)))

# Rename seqreader to SeqReader in Code column
timing$Code[timing$Code == "seqreader"] <- "SeqReader"

# Rename kseq to kseq (critical section) in Code column
timing$Code[timing$Code == "kseq"] <- "kseq (critical section)"

ggplot(timing, aes(x = threads, y = tm, color = Code)) +
  geom_line() + geom_point(aes(x=threads, y = tm_points), size=6) +
  xlab("Threads") + ylab("Time (mm:ss)") +
  theme_bw() + theme(text=element_text(size=30)) +
  scale_color_manual(values=c("#56B4E9", "#E69F00")) +
  scale_x_continuous(breaks=c(1, 25, 50, 75, 100, 125), limits = c(0, 128)) +
  scale_y_time(labels = function(l) strftime(l, '%M:%S')) +
  theme(legend.position = "top", plot.margin=unit(c(0.2, 2, 0.2, 0.2), 'cm'))
ggsave("input_plot.png", width=8.75, height=8)
